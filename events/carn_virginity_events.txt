namespace = carn_virginity

# Seeding event
carn_virginity.0001 = {
	hidden = yes
	type = character_event

	trigger = {
		NOT = { has_character_flag = carn_virginity_seeded }
		is_alive = yes
	}

	immediate = {
		carn_virginity_seed_effect = yes
	}
}

# Notify if virginity is lost
carn_virginity.0002 = {
	hidden = yes
	type = character_event

	trigger = {
		NOT = { has_character_flag = carn_block_virginity_notifications }
	}

	immediate = {
		if = {
			limit = { carn_is_virgin_trigger = yes }
			send_interface_toast = {
				title = carn_msg_virginity_regained
				right_icon = this
				custom_description_no_bullet = {
					text = carn_regain_virginity_effect
				}
			}
		}
		else = {
			send_interface_toast = {
				title = carn_msg_virginity_lost
				right_icon = this
				custom_description_no_bullet = {
					text = carn_lose_virginity_effect
				}
			}
		}
	}
}

# Effect for carn_virginity.0003 so no notifications are shown
scripted_effect carn_virginity_0003_lose_virginity_effect = {
	add_character_flag = {
		flag = carn_block_virginity_notifications
		days = 2
	}
	carn_lose_virginity_effect = yes
}

# Lose virginity status on pregnancy for everyone involved
carn_virginity.0003 = {
	hidden = yes
	type = character_event

	trigger = {
		OR = {
			carn_is_virgin_trigger = yes
			AND = {
				exists = scope:father
				scope:father = { carn_is_virgin_trigger = yes }
			}
			AND = {
				exists = scope:real_father
				scope:real_father = { carn_is_virgin_trigger = yes }
			}
		}
	}

	immediate = {
		carn_virginity_0003_lose_virginity_effect = yes
		if = {
			limit = { exists = scope:father }
			scope:father = { carn_virginity_0003_lose_virginity_effect = yes }
		}
		if = {
			limit = { exists = real_father }
			scope:real_father = { carn_virginity_0003_lose_virginity_effect = yes }
		}
	}
}
